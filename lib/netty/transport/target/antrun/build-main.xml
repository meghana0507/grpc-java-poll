<?xml version="1.0" encoding="UTF-8" ?>
<project name="maven-antrun-" default="main"  >
<target name="main">
  <taskdef resource="net/sf/antcontrib/antlib.xml"/>
  <exec outputproperty="gitOutput.lastCommit" resultproperty="gitExitCode.lastCommit" executable="git" failonerror="false" failifexecutionfails="false">
    <arg value="log"/>
    <arg value="-1"/>
    <arg value="--format=format:%h %H %cd"/>
    <arg value="--date=iso"/>
  </exec>
  <propertyregex input="${gitOutput.lastCommit}" select="\1" casesensitive="true" property="shortCommitHash" defaultValue="0" regexp="^([0-9a-f]+) .*$"/>
  <propertyregex input="${gitOutput.lastCommit}" select="\1" casesensitive="true" property="longCommitHash" defaultValue="0000000000000000000000000000000000000000" regexp="^[0-9a-f]+ ([0-9a-f]{40}) .*$"/>
  <propertyregex input="${gitOutput.lastCommit}" select="\1" casesensitive="true" property="commitDate" defaultValue="1970-01-01 00:00:00 +0000" regexp="^[0-9a-f]+ [0-9a-f]{40} (.*)$"/>
  <exec outputproperty="gitOutput.repoStatus" resultproperty="gitExitCode.repoStatus" executable="git" failonerror="false" failifexecutionfails="false">
    <arg value="status"/>
    <arg value="--porcelain"/>
  </exec>
  <if>
    <equals arg2="0" arg1="${gitExitCode.repoStatus}"/>
    <then>
      <if>
        <equals arg2="" arg1="${gitOutput.repoStatus}"/>
        <then>
          <property name="repoStatus" value="clean"/>
        </then>
        <else>
          <property name="repoStatus" value="dirty"/>
        </else>
      </if>
    </then>
    <else>
      <property name="repoStatus" value="unknown"/>
    </else>
  </if>
  <echo>Current commit: ${shortCommitHash} on ${commitDate}</echo>
  <property name="metaInfDir" value="C:\Users\Meghana\Documents\GitHub\grpc-java\lib\netty\transport\target\classes/META-INF"/>
  <property name="versionPropFile" value="${metaInfDir}/io.netty.versions.properties"/>
  <mkdir dir="${metaInfDir}"/>
  <delete file="${versionPropFile}" quiet="true"/>
  <propertyfile file="${versionPropFile}" comment="Generated by netty-parent/pom.xml">
    <entry value="4.1.0.Beta5-SNAPSHOT" key="netty-transport.version"/>
    <entry pattern="yyyy-MM-dd HH:mm:ss Z" value="now" type="date" key="netty-transport.buildDate"/>
    <entry value="${commitDate}" key="netty-transport.commitDate"/>
    <entry value="${shortCommitHash}" key="netty-transport.shortCommitHash"/>
    <entry value="${longCommitHash}" key="netty-transport.longCommitHash"/>
    <entry value="${repoStatus}" key="netty-transport.repoStatus"/>
  </propertyfile>
</target>
</project>